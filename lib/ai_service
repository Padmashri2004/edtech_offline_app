import 'package:flutter_gemma/flutter_gemma.dart';

class AIService {
  // Uses the modern method to access the local model
  Future<String> generate100MarkExam({required String topic, required String tier}) async {
    final model = await FlutterGemma.getActiveModel();
    
    // Exact requirement-based prompts
    String pattern = (tier == 'Basic') 
      ? """BASIC TIER PATTERN (Total 100m):
         1. 5 MCQs (4 options, 1 right) [5m]
         2. 5 Fill-ups (Hints in brackets) [5m]
         3. 5 Match Following pairs [5m]
         4. 5 Rearrange sequences [5m]
         5. 5 Odd One Out [5m]
         6. 7 Short Answer questions (Choice: Ans any 5) [25m]
         7. 7 Long Answer questions (Choice: Ans any 5) [50m]"""
      : """ADVANCED TIER PATTERN (Total 100m):
         1. 5 Multi-select MCQs [5m]
         2. 5 Fill-ups (No hints) [5m]
         3. 5 Correct incorrect statements [5m]
         4. 1 Summary task [5m]
         5. 3 Assertion-Reason pairs [3m]
         6. 2 True/False questions [2m]
         7. 7 Short Answer questions (Choice: Ans any 5) [25m]
         8. 7 Long Answer questions (Choice: Ans any 5) [50m]""";

    String finalPrompt = """
      Generate a $topic exam in JSON format following this marking scheme:
      $pattern
      Return ONLY valid JSON.
    """;

    final response = await model.getResponse(prompt: finalPrompt);
    return response ?? "Generation Failed";
  }
}